---
title: "Sample Size Determination for Case-Control Microbiome Studies with Shiny"
author: "Federico Mattiello"
output:
  pdf_document:
    toc: false
    highlight: zenburn
---
  


This report is automatically generated with the _R_ language 


##INPUTS

```{r parameters, echo=FALSE}
aux <- inputPars()
colnames(aux) <- rep.int(c("Param. Name", "Value"), 2L)
kable(aux, format = "markdown")
```



##OUTPUTS
  
  
###Settings graphs  

The following graphs show desired ranked abundance proportions with their respective 
estimates based on the two simulated samples of size 
`r inputPars()[5, 4]` and `r inputPars()[6, 4]`, respectively. 

```{r piPlots, echo=FALSE, fig.height=3}
drawPiPlot(
    countsData = generatedCounts()$piDirList[[1L]], 
    piOneObj = piOne()$'piVec'[[1L]],
    piTwoObj = piTwo()$'piTwo'[[1L]], 
    main = ifelse(input$entero == 'YES', 'Enterotype: \'Bacteroides\'', ''), 
    ylab = 'Abundance Proportions', 
    theta = round(piOne()$'theta'[[1L]], 3L))

if (input$entero == 'YES')
{
  drawPiPlot(
      countsData = generatedCounts()$piDirList[[2L]], 
      piOneObj = piOne()$'piVec'[[2L]],
      piTwoObj = piTwo()$'piTwo'[[2L]], 
      main = 'Enterotype: \'Prevotella\'', # 'Enterotype 2', 
      ylab = 'Abundancy Proportions', 
      theta = round(piOne()$'theta'[[2L]], 3L))
  drawPiPlot(
      countsData = generatedCounts()$piDirList[[3L]], 
      piOneObj = piOne()$'piVec'[[3L]],
      piTwoObj = piTwo()$'piTwo'[[3L]], 
      main = 'Enterotype: \'Ruminococcus\'', # 'Enterotype 3', 
      ylab = 'Abundancy Proportions', 
      theta = round(piOne()$'theta'[[3L]], 3L))
} else {}
```
  

###Wald Test based on one simulation  

Hereafter the results of the Wald test based on one simulation:  
```{r powOne, echo=FALSE}
auxHmpTest()
```  


###Power simulation with current settings  

Power results for the current settings:
```{r powSimMC, echo=FALSE}
auxSingleWald()
```


###Power and sample size graph  

The next graph shows the **power** _vs._ the **sample size** behaviour where the latter 
goes from `r inputPars()[7, 4]` to `r inputPars()[8, 4]`.

```{r powPlot, echo=FALSE}
pars <- inputPars()
alpha <- as.numeric(pars[4, 4])
minSize <- as.integer(pars[7, 4])
maxSize <- as.integer(pars[8, 4])
par(mar = c(4, 4, 1, 1))
plot(mcHmpWaldResults()$'seqSizes', mcHmpWaldResults()$'pow', 
    xlim = c(minSize, maxSize) + c(-2L, 2L), 
    ylim = c(0, 1.1), pch = 19, lwd = 1,
    type = 'o', #main = 'Power vs. Sample Size',
    xlab = 'sample size', ylab = 'power')
abline(h = c(0, alpha, 1), lty = 4, col = 'gray70', lwd = 2)
text(x =  minSize, y = alpha, pos = 3, 
    labels = paste0('  alpha = ', alpha), cex = 1.1)

sampleVec <- seq(from = minSize, to = maxSize,length = 100)
xCoord <- sampleVec[75L]
findSpecificPowFun <- approxfun(
    x = mcHmpWaldResults()$'seqSizes', 
    y = mcHmpWaldResults()$'pow')
resCoords <- c(
    'x' = xCoord, 
    'y' = findSpecificPowFun(xCoord)
)
points(resCoords['x'], resCoords['y'], pch = 3, lwd = 3, cex = 2.5, col = 'red2')
lines(x = c(resCoords['x'], resCoords['x']), 
    y = c(0, resCoords['y']), 
    lty = 4, col = 'red2', lwd = 2)
lines(x = c(0, resCoords['x']), 
    y = c(resCoords['y'], resCoords['y']), 
    lty = 4, col = 'red2', lwd = 2)

text(x = resCoords['x'], y = resCoords['y'], 
    labels = paste0(
        'Size=', round(resCoords['x'], 2L),
        '\n Power=', round(resCoords['y'], 3L)), 
    pos = 1, offset = 1, cex = 1.3)
```


---------------------------------------------------------------------------  


##R Session Information  

The R session information (including the OS info, R version and all 
packages used):

```{r session-info}
sessionInfo()
Sys.time()
```

